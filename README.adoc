== Springdocs Native test
:icons: font

Example of SpringBoot project with autogenerated OpenApi documentation.

References::

* https://repo.spring.io/milestone/org/springframework/experimental/spring-graalvm-native-docs/0.8.5/spring-graalvm-native-docs-0.8.5.zip!/reference/index.html[Spring Native v0.8.5 (experimental)]
* https://springdoc.org/[springdoc-openapi]

== Requirements

* JDK v11+ (recommended installation with https://sdkman.io/[SDKMAN!])
* https://www.docker.com/[Docker] container engine
* https://kind.sigs.k8s.io[Kind] to start a local K8s instance.
It is possible to start with with Docker
* https://skaffold.dev/[Skaffold] to orchestrate the build and k8s deployment

== Build

Before building make sure to start a kind instance with

 $ kind create cluster --config kind-config.yaml

To build the normal "Java" mode run.

 $ skaffold dev --port-forward

To build the native image run.

 $ NATIVE_IMAGE=true skaffold dev --port-forward

IMPORTANT: Both builds use the same image tag.
Make sure to delete the local image before rebuilding it.

== Usage

Service contains a simple _echo_ endpoint that can be called with:

----
curl -X POST http://localhost:8080/echo \
-H 'Content-Type: application/json' \
-d '{"text":"Hello!!"}'
----

For the generated documentation visit:

Swagger UI:: http://localhost:8080/swagger-ui/index.html?configUrl=/v3/api-docs/swagger-config
OpenAPI endpoint:: http://localhost:8080/v3/api-docs

=== Extra goodies

Skaffold setup includes https://github.com/kubernetes-sigs/metrics-server[metrics-server] deployment.
Use `kubetcl top pods` to see cpu and memory usage of the application.

== Notes

SpringFox did not work out-of-the-box once the dependency was added.

 implementation 'io.springfox:springfox-boot-starter:3.0.0'
